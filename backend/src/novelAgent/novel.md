## 小说智能体整体流程图（支持中断与恢复）

> 说明：
>
> * 🧑 = 人工操作
> * 🤖 = AI 操作
> * 💾 = 状态持久化（Checkpoint）
> * ⏸ = 可中断 / 可恢复节点

---

### Phase 0｜项目初始化（一次性）

🧑 填写小说基础表单

* 主角设定（性格 / 行为边界）
* 题材
* 节奏
* 文风
* 禁忌点
* 小说类型（短篇 / 连载）
* 默认章节字数

💾 保存：`project_config`

⏸ **中断点 A**：

* 下次进入 → 直接加载 `project_config`
* 不再重复配置

⬇️

---

### Phase 1｜故事主线构建（可选，但推荐）

🤖 基于 `project_config` 生成

* 故事整体大纲
* 主线目标（一句话）
* 阶段拆解（不是章节）

🧑 确认 / 修改 / 重新生成

💾 保存：

* `story_outline`
* `main_goal`

⏸ **中断点 B**：

* 若已存在 `story_outline` → 跳过本阶段

⬇️

---

### Phase 2｜章节循环（核心流程）

> 以下流程对每一章重复执行

---

#### Step 2.1｜章节上下文准备

🤖 自动读取状态：

* `project_config`
* `main_goal`
* 当前章节号 n
* 上一章摘要（若存在）
* 主角当前状态（若存在）

🤖 生成：

* 本章写作上下文

💾 保存：`chapter_context[n]`

⏸ **中断点 C**：

* 可随时恢复到「第 n 章待生成」状态

⬇️

---

#### Step 2.2｜本章参数确认

🧑 输入 / 确认：

* 本章目标字数（可覆盖默认）
* 是否特殊章节（高潮 / 转折 / 收束）

⬇️

---

#### Step 2.3｜生成本章内容

🤖 输入：

* `chapter_context[n]`
* 本章字数

🤖 输出：

1. 本章正文
2. 下一章大纲（草稿）
3. 本章摘要（自动生成）
4. 主角状态变化（自动生成）

💾 保存：

* `chapter_content[n]`
* `chapter_summary[n]`
* `protagonist_state[n]`
* `next_outline_draft[n+1]`

⏸ **中断点 D**：

* 内容已完整生成，可随时退出

⬇️

---

#### Step 2.4｜人工审阅与控制（质量闸门）

🧑 人工操作：

* 润色 / 重写「下一章大纲」
* 确认 / 修正「主角当前状态」

🧑 轻量勾选：

* 是否推进主线：是 / 否
* 节奏判断：慢 / 正常 / 快
* 是否触犯禁忌：是 / 否

💾 保存：

* `chapter_review[n]`
* `next_outline_final[n+1]`

❗ 若未通过 → 返回 Step 2.3 或 2.4

⬇️

---

#### Step 2.5｜进入下一章 or 中断

🧑 选择：

* ▶ 进入第 n+1 章（回到 Step 2.1）
* ⏸ 暂停创作

⏸ **中断点 E**：

* 下次进入 → 直接从当前章节恢复

---

## 关键状态一览（用于恢复）

| 状态名                     | 作用     | 是否长期 |
| ----------------------- | ------ | ---- |
| project_config          | 小说全局配置 | 是    |
| story_outline           | 故事整体结构 | 是    |
| main_goal               | 主线锚点   | 是    |
| chapter_context[n]      | 本章上下文  | 否    |
| chapter_content[n]      | 本章正文   | 否    |
| chapter_summary[n]      | 本章摘要   | 是    |
| protagonist_state[n]    | 主角状态递进 | 是    |
| next_outline_final[n+1] | 下一章大纲  | 否    |

---

## 核心设计原则总结

* 长期信息只配置一次
* 章节信息逐章推进
* AI 不猜状态，只读取状态
* 任意中断点都可恢复

> 这是一个「状态驱动 + 人工可控 + AI 执行」的小说智能体流程。
